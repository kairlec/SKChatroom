<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.skstudio.dao.ActionMessageMapper">

    <update id="initialize">
        CREATE TABLE IF NOT EXISTS action_message(message_id BIGINT NOT NULL PRIMARY KEY,action_type VARCHAR(32) NOT NULL,from_id BIGINT NOT NULL, FOREIGN KEY(from_id) REFERENCES user(user_id),to_id BIGINT NOT NULL, FOREIGN KEY(to_id) REFERENCES user(user_id),time DATETIME NOT NULL,topic VARCHAR(128),context NVARCHAR(1024) NOT NULL,is_read BOOL NOT NULL);
    </update>

    <select id="get" resultType="cn.skstudio.pojo.ActionMessage">
        SELECT *
        FROM action_message
        WHERE message_id = #{messageID}
    </select>

    <select id="getAllFromActionMessages" resultType="cn.skstudio.pojo.ActionMessage">
        SELECT *
        FROM action_message
        WHERE from_id = #{userID}
        AND time >= #{after}
    </select>

    <select id="getAllToActionMessages" resultType="cn.skstudio.pojo.ActionMessage">
        SELECT *
        FROM action_message
        WHERE to_id = #{userID}
        AND time >= #{after}
    </select>

    <select id="getFromToActionMessages" resultType="cn.skstudio.pojo.ActionMessage">
        SELECT *
        FROM action_message
        WHERE from_id = #{fromUserID}
        AND to_id = #{toUserID}
        AND time >= #{after}
    </select>

    <insert id="addActionMessage" parameterType="cn.skstudio.pojo.ActionMessage">
        INSERT INTO action_message(message_id,action_type,from_id,to_id,time,topic,context,is_read)
         VALUES(#{messageID},#{action},#{fromID},#{toID},#{time},#{topic},#{context},#{isRead})
    </insert>

    <update id="updateContent">
        UPDATE
        `action_message`
        <set>
            content = #{content}
        </set>
        WHERE message_id = #{messageID}
    </update>

    <update id="read">
        UPDATE
        `action_message`
        <set>
            is_read = true
        </set>
        WHERE message_id = #{messageID}
    </update>

</mapper>